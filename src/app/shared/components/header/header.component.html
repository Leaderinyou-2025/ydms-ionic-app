<ion-header [ngStyle]="getBackgroundStyle()" class="block relative w-full h-auto">
  <!-- Back button -->
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="" mode="ios" [defaultHref]="defaultBackHref"></ion-back-button>
    </ion-buttons>
    <ion-label *ngIf="(pageTitle || pageTitleString) && !caption && !animeImage && !searchbar && !animation && !segment"
               class="text-base text-white">
      <ng-container *ngIf="pageTitle && !pageTitleString">{{ pageTitle | translate }}</ng-container>
      <ng-container *ngIf="pageTitleString">{{ pageTitleString }}</ng-container>
    </ion-label>
  </ion-toolbar>

  <!-- Page title -->
  <div *ngIf="(pageTitle || pageTitleString) && (caption || animeImage || searchbar || animation || segment)"
       class="block pt-2 ion-padding-start ion-padding-end"
       [class]="(animation || animeImage) ? 'w-2/3' : 'w-full'">
    <h1 class="text-2xl font-semibold text-white m-0 p-0" [class.pb-3]="!caption">
      <ng-container *ngIf="pageTitle && !pageTitleString">{{ pageTitle | translate }}</ng-container>
      <ng-container *ngIf="pageTitleString">{{ pageTitleString }}</ng-container>
    </h1>
    <p *ngIf="caption" class="text-base italic pb-5 pt-2">
      {{ caption | translate }}
    </p>
  </div>

  <!-- Anime image -->
  <ng-container *ngIf="animeImage">
    <ion-img class="float-animation"
             [src]="animeImage.imageUrl"
             [alt]="animeImage.name"
             [class]="animeImage.position?.position || 'absolute'"
             [style.top]="animeImage.position?.top || 'auto'"
             [style.right]="animeImage.position?.right || '0'"
             [style.bottom]="animeImage.position?.bottom || '0'"
             [style.left]="animeImage.position?.left || 'auto'"
             [style.width]="animeImage.width"
             [style.height]="animeImage.height"></ion-img>
  </ng-container>

  <!-- Animation  -->
  <ng-container *ngIf="animation">
    <ng-lottie [class]="animation.position?.position || 'absolute'"
               [style.top]="getSafeTop(animation.position?.top)"
               [style.right]="animation.position?.right || '0'"
               [style.bottom]="animation.position?.bottom || '0'"
               [style.left]="animation.position?.left || 'auto'"
               [options]="animation.animation"
               [style.width]="animation.width"
               [style.height]="animation.height"></ng-lottie>
  </ng-container>

  <!-- Searchbar & segment -->
  <div class="flex flex-wrap items-end justify-items-center w-full h-28" *ngIf="segment || searchbar">
    <!-- Searchbar -->
    <div *ngIf="searchbar" class="block w-full py-2 px-2">
      <ion-searchbar
        mode="ios"
        class="ion-no-padding min-h-0 flex-wrap"
        [type]="searchbar.type"
        [inputmode]="searchbar.inputmode"
        [placeholder]="searchbar.placeholder"
        [value]="searchbar.value"
        [disabled]="searchbar.disabled"
        [searchIcon]="searchbar.searchIcon"
        [showCancelButton]="searchbar.showCancelButton"
        [cancelButtonText]="searchbar.cancelButtonText"
        [cancelButtonIcon]="searchbar.cancelButtonIcon"
        [showClearButton]="searchbar.showClearButton"
        [clearIcon]="searchbar.clearIcon"
        [maxlength]="searchbar.maxlength"
        [minlength]="searchbar.minlength"
        [debounce]="searchbar.debounce || 1000"
        [animated]="searchbar.animated"
        (ionInput)="onInputSearch($event)">
      </ion-searchbar>
    </div>

    <!-- Segment -->
    <div *ngIf="segment" class="block w-full py-2 px-2">
      <ion-segment
        mode="ios"
        [color]="segment.color"
        [value]="segment.value"
        [scrollable]="segment.scrollable"
        [disabled]="segment.disabled"
        (ionChange)="onChangeSegment($event)">

        <ng-container *ngFor="let segmentButton of segment.buttons">
          <ion-segment-button
            [value]="segmentButton.value"
            [layout]="segmentButton.layout"
            [type]="segmentButton.type"
            [disabled]="segmentButton.disabled">
            <ion-label class="pr-1" *ngIf="segmentButton.label">{{ segmentButton.label | translate }}</ion-label>
            <ion-icon *ngIf="segmentButton.icon" [name]="segmentButton.icon" [color]="segmentButton.iconColor"></ion-icon>
          </ion-segment-button>
        </ng-container>
      </ion-segment>
    </div>
  </div>
</ion-header>
