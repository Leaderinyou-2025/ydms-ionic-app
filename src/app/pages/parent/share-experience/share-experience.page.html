<!-- Header trang với tiêu đề, mô tả, hình ảnh anime và segment tab -->
<app-header
  [pageTitle]="TranslateKeys.SHARE_EXPERIENCE_TITLE"
  [caption]="TranslateKeys.SHARE_EXPERIENCE_CAPTION"
  backgroundImageUrl="/assets/images/banner.svg"
  [animeImage]="animeImage"
  [segment]="segment"
  (changeSegment)="onTabChange($event)">
</app-header>

<ion-content [fullscreen]="true" class="ion-padding-start ion-padding-end custom-page-bg-light">
  <!-- Kéo để làm mới dữ liệu -->
  <ion-refresher slot="fixed" mode="md" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading skeleton -->
  <div *ngIf="isLoading && !isLoadMore" class="mt-3">
    <ion-skeleton-text [animated]="true" class="w-full h-48 rounded-lg mb-3" *ngFor="let i of Array(10)"></ion-skeleton-text>
  </div>

  <!-- No posts message -->
  <div *ngIf="isLoading === false && experienceList.length === 0" class="flex flex-col items-center justify-center py-12">
    <ion-icon name="document-text-outline" class="text-6xl text-gray-400 mb-4"></ion-icon>
    <p class="text-gray-500 dark:text-gray-400 text-center italic">{{ TranslateKeys.SHARE_EXPERIENCE_NO_POSTS | translate }}</p>
  </div>

  <!-- Experience posts list -->
  <div *ngIf="experienceList?.length" class="py-4">
    <!-- Experience cards -->
    <div *ngFor="let experience of experienceList" routerLink="/{{PageRoutes.SHARE_EXPERIENCE}}/{{experience.id}}"
         class="bg-white dark:bg-gray-800 rounded-xl shadow-md mb-4 overflow-hidden relative">

      <!-- Card header -->
      <div class="flex items-center justify-between p-4 border-b border-gray-100 dark:border-gray-700">
        <div class="flex items-center flex-1">
          <ion-avatar class="w-10 h-10 mr-3">
            <ion-img src="assets/icons/svg/avatar.svg" alt="Avatar" class="rounded-full"></ion-img>
          </ion-avatar>
          <div class="flex-1">
            <h3 class="text-base font-medium text-gray-800 dark:text-gray-200">{{ experience.parent_id.name }}</h3>
            <p class="text-xs text-gray-500 dark:text-gray-400">{{ experience.create_date | date: DateFormat.DATE_ONLY }}</p>
          </div>
        </div>

        <!-- Area of expertise badge -->
        <div class="flex items-center">
          <ion-chip [color]="getAreaColor(experience.area_of_expertise)" class="text-xs">
            {{ getAreaLabel(experience.area_of_expertise) | translate }}
          </ion-chip>
        </div>
      </div>

      <!-- Nội dung chính của bài chia sẻ -->
      <div class="p-4">
        <!-- Tiêu đề bài chia sẻ -->
        <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">{{ experience.name }}</h4>

        <!-- Nội dung kinh nghiệm (hiển thị 3 dòng đầu) -->
        <div class="text-justify text-gray-700 dark:text-gray-300 line-clamp-5-custom">
          {{ CommonConstants.stripHtmlAndTruncate(experience.experience_content) }}
        </div>
      </div>

      <!-- Card actions and status -->
      <div class="flex items-center justify-between px-4 py-3 border-t border-gray-100 dark:border-gray-700" (click)="$event.stopPropagation()">
        <!-- Like/Love buttons - Unified design for both tabs -->
        <div class="flex items-center justify-start gap-2">
          <ng-container *ngIf="experience.status === ExperienceStatus.ACCEPTED">
            <!-- Like option -->
            <ion-chip color="primary" (click)="selectReaction(experience, ExperienceReviewType.LIKE)">
              <ion-icon name="thumbs-up"></ion-icon>
              <span class="ml-1">{{ experience.total_like || 0 }}</span>
            </ion-chip>

            <!-- Love option -->
            <ion-chip color="danger" (click)="selectReaction(experience, ExperienceReviewType.LOVE)">
              <ion-icon name="heart"></ion-icon>
              <span class="ml-1">{{ experience.total_love || 0 }}</span>
            </ion-chip>
          </ng-container>

          <ng-container *ngIf="currentTab === 'family'">
            <!--    Edit button      -->
            <ion-button shape="round" size="small" color="primary"
                        *ngIf="experience.status !== ExperienceStatus.ACCEPTED"
                        routerLink="{{PageRoutes.CREATE_EXPERIENCE}}/{{experience.id}}">
              <span class="text-base py-1">{{ TranslateKeys.BUTTON_EDIT | translate }}</span>
            </ion-button>

            <!--    Delete button      -->
            <ion-button shape="round" size="small" color="danger"
                        *ngIf="experience.status !== ExperienceStatus.ACCEPTED"
                        (click)="onClickRemoveExperience(experience)">
              <span class="text-base py-1">{{ TranslateKeys.BUTTON_DELETE | translate }}</span>
            </ion-button>
          </ng-container>
        </div>

        <!-- Status badge (for family tab or own posts) -->
        <div *ngIf="currentTab === 'family'" class="flex items-center gap-2">
          <ion-badge [color]="getStatusColor(experience.status)" class="text-xs px-2 py-1 rounded-full">
            {{ getStatusLabel(experience.status) | translate }}
          </ion-badge>
        </div>
      </div>
    </div>
  </div>

  <!-- Infinite scroll -->
  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)">
    <ion-infinite-scroll-content loadingSpinner="bubbles">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>

<!-- Nút floating để tạo bài chia sẻ mới -->
<ion-fab vertical="bottom" horizontal="end" slot="fixed" class="mb-24">
  <ion-fab-button color="primary" routerLink="{{PageRoutes.CREATE_EXPERIENCE}}">
    <ion-icon name="add"></ion-icon>
  </ion-fab-button>
</ion-fab>

<app-footer></app-footer>
