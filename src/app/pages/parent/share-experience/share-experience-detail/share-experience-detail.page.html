<app-header
  [pageTitle]="TranslateKeys.SHARE_EXPERIENCE_DETAIL_TITLE"
  [caption]="TranslateKeys.SHARE_EXPERIENCE_CAPTION"
  defaultBackHref="/{{PageRoutes.SHARE_EXPERIENCE}}"
  backgroundImageUrl="/assets/images/banner.svg"
  [animeImage]="animeImage">
</app-header>

<ion-content [fullscreen]="true" class="ion-padding-start ion-padding-end custom-page-bg-light">
  <!-- Hiển thị loading khi đang tải dữ liệu -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-8">
    <ion-spinner name="bubbles"></ion-spinner>
  </div>

  <!-- Nội dung chi tiết bài chia sẻ kinh nghiệm -->
  <div *ngIf="experienceDetail" class="py-4">
    <!-- Card nội dung chính -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden">

      <!-- Header card với thông tin tác giả -->
      <div class="flex items-center justify-between p-6 border-b border-gray-100 dark:border-gray-700">
        <div class="flex items-center flex-1">
          <!-- Avatar tác giả -->
          <ion-avatar class="w-12 h-12 mr-4">
            <ion-img src="assets/icons/svg/avatar.svg" alt="Avatar" class="rounded-full"></ion-img>
          </ion-avatar>
          <!-- Thông tin tác giả -->
          <div class="flex-1">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">{{ experienceDetail.parent_id.name }}</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">{{ experienceDetail.create_date | date: DateFormat.DATE_ONLY }}</p>
          </div>
        </div>

        <!-- Chip lĩnh vực chuyên môn -->
        <div class="flex items-center">
          <ion-chip [color]="getAreaColor(experienceDetail.area_of_expertise)" class="text-xs">
            {{ getAreaLabel(experienceDetail.area_of_expertise) | translate }}
          </ion-chip>
        </div>
      </div>

      <!-- Tiêu đề bài chia sẻ -->
      <div class="px-6 pt-6">
        <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-200">{{ experienceDetail.name }}</h1>
      </div>

      <!-- Nội dung kinh nghiệm -->
      <div class="px-3 pb-6 text-gray-700 dark:text-gray-300 text-base">
        <quill-view [content]="experienceDetail.experience_content" theme="snow"></quill-view>
      </div>

      <div class="px-6 pb-6" *ngIf="experienceDetail.attach_file">
        <!--     Image preview       -->
        <div class="relative w-full border rounded-xl overflow-hidden"
             *ngIf="!experienceDetail.x_attach_file_name">
          <ion-img [src]="CommonConstants.formatBase64ImageUrl(experienceDetail.attach_file)"
                   class="w-full h-auto">
          </ion-img>
        </div>

        <!--     File list       -->
        <div class="w-full border rounded-xl overflow-hidden group" *ngIf="experienceDetail.x_attach_file_name">
          <ion-item lines="none" detail="false" class="bg-transparent" (click)="onClickDownloadFile()">
            <ion-icon slot="start" name="document-attach" class="text-xl text-sky-500"></ion-icon>
            <ion-label><span class="text-sky-500">{{ experienceDetail.x_attach_file_name }}</span></ion-label>
            <ion-icon slot="end" name="cloud-download" class="text-xl text-sky-500"></ion-icon>
          </ion-item>
        </div>
      </div>

      <div class="flex items-center justify-between px-4 py-3 border-t border-gray-100 dark:border-gray-700" (click)="$event.stopPropagation()">
        <!-- Like/Love buttons - Unified design for both tabs -->
        <div class="flex items-center justify-start gap-2">
          <ng-container *ngIf="experienceDetail.status === ExperienceStatus.ACCEPTED">
            <!-- Like option -->
            <ion-chip color="primary" (click)="selectReaction(ExperienceReviewType.LIKE)">
              <ion-icon name="thumbs-up"></ion-icon>
              <span class="ml-1">{{ experienceDetail.total_like || 0 }}</span>
            </ion-chip>

            <!-- Love option -->
            <ion-chip color="danger" (click)="selectReaction(ExperienceReviewType.LOVE)">
              <ion-icon name="heart"></ion-icon>
              <span class="ml-1">{{ experienceDetail.total_love || 0 }}</span>
            </ion-chip>
          </ng-container>

          <ng-container *ngIf="experienceDetail.status !== ExperienceStatus.ACCEPTED && experienceDetail.create_uid?.id === authData?.id">
            <!--    Edit button      -->
            <ion-button shape="round" size="small" color="primary"
                        routerLink="/{{PageRoutes.SHARE_EXPERIENCE}}/{{PageRoutes.CREATE_EXPERIENCE}}/{{experienceDetail.id}}">
              <span class="text-base py-1">{{ TranslateKeys.BUTTON_EDIT | translate }}</span>
            </ion-button>

            <!--    Delete button      -->
            <ion-button shape="round" size="small" color="danger"
                        (click)="onClickRemoveExperience()">
              <span class="text-base py-1">{{ TranslateKeys.BUTTON_DELETE | translate }}</span>
            </ion-button>
          </ng-container>
        </div>

        <!-- Status badge (for family tab or own posts) -->
        <div *ngIf="experienceDetail.create_uid?.id === authData?.id" class="flex items-center gap-2">
          <ion-badge [color]="getStatusColor(experienceDetail.status)" class="text-xs px-2 py-1 rounded-full">
            {{ getStatusLabel(experienceDetail.status) | translate }}
          </ion-badge>
        </div>
      </div>
    </div>
  </div>
</ion-content>
