<app-header
  [pageTitle]="TranslateKeys.TITLE_EMOTIONAL_SURVEY_HISTORY"
  [caption]="TranslateKeys.HOME_WELCOME_SUBTITLE"
  defaultBackHref="/{{PageRoutes.HOME}}"
  backgroundColor="linear-gradient(to bottom, #9333ea, #4c1d95)"
  [animeImage]="animeImage">
</app-header>

<ion-content [fullscreen]="true" class="native-padding-content  custom-page-bg-light ion-padding pb-32">
  <!-- Refresh -->
  <ion-refresher slot="fixed" mode="md" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading skeleton -->
  <div *ngIf="isLoading" class="mt-3">
    <ion-skeleton-text animated class="w-full h-28 rounded-lg mb-3" *ngFor="let i of Array(10)"></ion-skeleton-text>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && surveyHistory.length === 0" class="flex flex-col items-center justify-center py-10">
    <ion-icon name="document-text-outline" class="text-6xl text-gray-400 mb-4"></ion-icon>
    <p class="text-center text-gray-500">{{ TranslateKeys.TITLE_NO_SURVEY_HISTORY | translate }}</p>
  </div>

  <!-- Survey history list -->
  <div *ngIf="!isLoading && surveyHistory.length > 0" class="mt-3">
    <div class="space-y-3">
      <ion-card *ngFor="let survey of surveyHistory" routerLink="/{{PageRoutes.EMOTIONAL_SURVEY}}/{{survey.id}}"
                class=" shadow-md border border-gray-200 dark:border-gray-700">
        <ion-card-content class="relative">
          <ion-icon *ngIf="survey.create_date !== survey.write_date || survey['create_time'] !== survey['write_time']"
                    name="checkmark-circle" color="success" class="absolute right-3 top-3 text-2xl"></ion-icon>
          <ion-icon *ngIf="survey.create_date === survey.write_date && survey['create_time'] === survey['write_time']"
                    name="warning" color="warning" class="absolute right-3 top-3 text-2xl intense-shake-zoom"></ion-icon>
          <div class="font-medium text-xl">{{ survey.name }}</div>
          <div class="flex items-center justify-start pt-2 text-base">
            <ion-img src="assets/icons/svg/ico_top_mission.svg" alt="icon" class="w-5 h-5"
                     [class.intense-shake-zoom]="survey.create_date === survey.write_date && survey['create_time'] === survey['write_time']"></ion-img>
            <span class="font-bold">+{{ survey.rank_point }}</span>
            <span *ngIf="survey.create_date === survey.write_date && survey['create_time'] === survey['write_time']"
                  class="pl-3 italic text-red-500">
              {{ TranslateKeys.TITLE_TAKE_SURVEY_NOW | translate }}
            </span>
          </div>
          <div class="pt-2 text-xs italic" *ngIf="survey.create_date !== survey.write_date || survey['create_time'] !== survey['write_time']">
            {{ survey.create_date | date: DateFormat.DATE_ONLY }}
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Infinite scroll -->
  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)">
    <ion-infinite-scroll-content></ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
