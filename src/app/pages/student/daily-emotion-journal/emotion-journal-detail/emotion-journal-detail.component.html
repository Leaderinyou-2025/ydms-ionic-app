<app-header
  [pageTitle]="TranslateKeys.TITLE_DAILY_EMOTION_JOURNAL"
  [caption]="TranslateKeys.HOME_WELCOME_SUBTITLE"
  defaultBackHref="/{{PageRoutes.DAILY_EMOTION_JOURNAL}}"
  backgroundColor="linear-gradient(to bottom, #9333ea, #4c1d95)"
  [animeImage]="animeImage">
</app-header>

<ion-content [fullscreen]="true" class="custom-page-bg-light ion-padding">
  <!-- Loading skeleton -->
  <div *ngIf="isLoading" class="mt-3">
    <ion-skeleton-text animated class="w-full h-80 rounded-lg mb-3"></ion-skeleton-text>
  </div>

  <ng-container *ngIf="emotionalDiary">
    <!--  Chi tiết nhật ký cảm xúc  -->
    <div class="flex flex-col items-center justify-center gap-4 mb-4 py-5 bg-gray-300 rounded-xl dark:bg-gray-700">
      <ion-img *ngIf="emotionalDiary.answer_icon" [src]="CommonConstants.formatBase64ImageUrl(emotionalDiary.answer_icon || '')" class="w-52 h-auto"></ion-img>
      <p class="italic text-2xl text-center font-bold">{{ emotionalDiary.answer_text }}</p>
      <p class="max-w-72 text-base text-center"> {{ emotionalDiary.question_id?.name }}<br></p>

      <!-- Trạng thái chia sẻ -->
      <div class="w-full text-center" *ngIf="emotionalDiary.public_emotional">
        <div class="flex items-center justify-center w-full text-lg font-medium text-sky-500">
          <ion-icon name="share-social" class="pr-2 text-2xl"></ion-icon>
          {{ TranslateKeys.DAILY_EMOTION_JOURNAL_SHARED_WITH | translate }}
          <span class="pl-1 lowercase" *ngIf="emotionalDiary.public_emotional_to === PublicEmotionalOption.ALL">
            {{ TranslateKeys.DAILY_EMOTION_JOURNAL_SHARE_TYPE_ALL  | translate }}
          </span>
          <span class="pl-1 lowercase" *ngIf="emotionalDiary.public_emotional_to === PublicEmotionalOption.ALL_FRIENDS">
            {{ TranslateKeys.DAILY_EMOTION_JOURNAL_SHARE_TYPE_ALL_FRIENDS  | translate }}
          </span>
          <span class="pl-1 lowercase" *ngIf="emotionalDiary.public_emotional_to === PublicEmotionalOption.FRIENDS">
            {{ TranslateKeys.DAILY_EMOTION_JOURNAL_SHARE_TYPE_FRIENDS  | translate }}
          </span>
          <span class="pl-1 lowercase" *ngIf="emotionalDiary.public_emotional_to === PublicEmotionalOption.PARENT">
            {{ TranslateKeys.EMOTION_SHARE_TARGET_FAMILY  | translate }}
          </span>
          <span class="pl-1 lowercase" *ngIf="emotionalDiary.public_emotional_to === PublicEmotionalOption.TEACHER">
            {{ TranslateKeys.EMOTION_SHARE_TARGET_TEACHERS  | translate }}
          </span>
        </div>

        <!--  Danh sách bạn bè được chia sẻ -->
        <div class="flex items-center justify-center flex-wrap gap-2 py-2" *ngIf="sharedFriends && sharedFriends?.length">
          <ng-container *ngFor="let friend of sharedFriends; let i = index;">
            <ion-badge color="success" *ngIf="i < 5">{{ friend.nickname }}</ion-badge>
          </ng-container>
          <span *ngIf="sharedFriends.length >= 5" class="text-base font-bold">...(+{{ sharedFriends.length - 5 }})</span>
        </div>

        <!--    Stop sharing button    -->
        <ion-button shape="round" color="primary" class="min-h-10" (click)="onClickUnPublicEmotional()">
          {{ TranslateKeys.DAILY_EMOTION_JOURNAL_STOP_SHARING | translate }}
        </ion-button>
      </div>

      <!--   Date   -->
      <p class="ml-auto mr-5 text-sm italic text-right">{{ emotionalDiary['create_time'] }} {{ emotionalDiary.create_date | date: DateFormat.DATE_ONLY }}</p>
    </div>

    <!--  Hướng dẫn, gợi ý điều tiết cảm xúc  -->
    <div class="flex flex-col items-center justify-center gap-4 py-5 px-4 bg-gray-300 rounded-xl dark:bg-gray-700" *ngIf="answerOption">
      <p class="max-w-72 text-xl text-orange-500 text-center font-bold" *ngIf="answerOption.encourage" [innerHTML]="answerOption.encourage"></p>

      <!--   Tiêu đề chủ đề   -->
      <ng-container *ngIf="instructionCategories && !emotionGuides?.length">
        <p class="py-3 text-base text-center" *ngFor="let instruction of instructionCategories"> {{ instruction.name }} </p>
      </ng-container>

      <!--   Bài hướng dẫn   -->
      <ng-container *ngIf="emotionGuides">
        <div *ngFor="let item of emotionGuides"
             class="flex justify-between items-center w-full p-4 bg-purple-500 text-white rounded-xl">
          <div class="flex-1">
            <p class="text-base mb-1">{{ item.name }}</p>
            <div class="flex items-center text-base">
              <ion-img src="assets/icons/svg/ico_top_mission.svg" alt="icon" class="w-6 h-6 object-contain intense-shake-zoom"></ion-img>
              <span class="font-bold">+{{ item.rank_point || 0 }}</span>
            </div>
          </div>
          <ion-button class="task-button ml-2 h-9 text-xs" fill="outline" (click)="onClickExecuteEmotionGuide(item)">
            {{ TranslateKeys.BUTTON_EXECUTE | translate }}
          </ion-button>
        </div>
      </ng-container>
    </div>
  </ng-container>
</ion-content>

