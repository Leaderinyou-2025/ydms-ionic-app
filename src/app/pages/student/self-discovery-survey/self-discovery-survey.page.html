<app-header
  [pageTitle]="TranslateKeys.TITLE_SELF_DISCOVERY_SURVEY_HISTORY"
  defaultBackHref="/{{PageRoutes.HOME}}"
  backgroundColor="linear-gradient(to bottom, #9333ea, #4c1d95)"
  [animeImage]="animeImage"
>
</app-header>

<ion-content [fullscreen]="true" class="native-padding-content font-comic-sans custom-page-bg-light ion-padding">
  <!-- Pull to refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading skeleton -->
  <div *ngIf="isLoading">
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && surveyHistory.length === 0" class="flex flex-col items-center justify-center py-10">
    <ion-icon name="document-text-outline" class="text-6xl text-gray-400 mb-4"></ion-icon>
    <p class="text-center text-gray-500">{{ TranslateKeys.TITLE_NO_SELF_DISCOVERY_SURVEY_HISTORY | translate }}</p>
    <ion-button (click)="createNewSurvey()" color="primary" fill="solid" class="mt-4">
      {{ TranslateKeys.BUTTON_CREATE_FIRST_SURVEY | translate }}
    </ion-button>
  </div>

  <!-- Survey history list -->
  <div *ngIf="!isLoading && surveyHistory.length > 0" class="mt-3 mb-[35px]">
    <div class="space-y-3">
      <ion-card *ngFor="let survey of displayedItems" class="font-comic-sans shadow-md border border-gray-200 dark:border-gray-700" (click)="viewSurveyDetail(survey.id)">
        <ion-card-content class="p-0">
          <div class="flex items-center p-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex-1">
              <div class="flex items-center">
                <span class="text-2xl mr-2">{{ getDiscoveryLevelEmoji(survey.discoveryLevel) }}</span>
                <span class="font-medium">{{ survey.result }}</span>
              </div>
              <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                {{ formatDate(survey.date) }}
              </div>
            </div>
            <div class="flex items-center">
              <div class="text-center">
                <div class="text-lg font-bold">{{ survey.score }}</div>
                <div class="text-xs text-gray-500 dark:text-gray-400">{{ TranslateKeys.TITLE_DISCOVERY_POINTS | translate }}</div>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Infinite scroll -->
  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)" [disabled]="!hasMoreItems">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      [loadingText]="TranslateKeys.LOADING_MORE_ITEMS | translate">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <!-- Floating action button to add new entry -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="mb-4 mr-4">
    <ion-fab-button color="primary" class="shadow-lg rounded-[30px]" (click)="createNewSurvey()">
      <span class="text-xl">âž•</span>
    </ion-fab-button>
  </ion-fab>
</ion-content>
