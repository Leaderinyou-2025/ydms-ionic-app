<app-header
  [pageTitle]="TranslateKeys.TITLE_FAMILY_DIALOGUE_SESSION_HISTORY"
  defaultBackHref="/{{PageRoutes.HOME}}"
  backgroundColor="linear-gradient(to bottom, #9333ea, #4c1d95)"
  [animeImage]="animeImage"
>
</app-header>

<ion-content [fullscreen]="true" class="native-padding-content  custom-page-bg-light ion-padding pb-32">
  <!-- Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading skeleton -->
  <div *ngIf="isLoading">
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && sessionHistory.length === 0" class="flex flex-col items-center justify-center py-10">
    <ion-icon name="document-text-outline" class="text-6xl text-gray-400 mb-4"></ion-icon>
    <p class="text-center text-gray-500">{{ TranslateKeys.TITLE_NO_FAMILY_DIALOGUE_SESSION_HISTORY | translate }}</p>
  </div>

  <!-- Session history list -->
  <div *ngIf="!isLoading && sessionHistory.length > 0" class="mt-3">
    <div class="space-y-3 mb-[30px]">
      <ion-card *ngFor="let session of displayedItems" class=" shadow-md border border-gray-200 dark:border-gray-700" (click)="viewSessionDetail(session.id)">
        <ion-card-content class="p-0">
          <div class="flex items-center p-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex-1">
              <div class="flex items-center">
                <span class="font-medium">{{ session.title }}</span>
              </div>
              <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                {{ formatDate(session.date) }}
              </div>
              <p class="text-gray-600 dark:text-gray-300 mt-2">{{ session.description }}</p>
            </div>
            <div class="text-center">
              <ion-badge
                [color]="session.status === 'completed' ? 'success' : session.status === 'in_progress' ? 'warning' : 'primary'"
                class="rounded-full px-3 py-1 text-xs">
                {{ session.status === 'completed' ? 'Đã hoàn thành' :
                   session.status === 'in_progress' ? 'Đang thực hiện' : 'Chưa thực hiện' }}
              </ion-badge>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Infinite scroll -->
  <ion-infinite-scroll threshold="100px" (ionInfinite)="onIonInfinite()" *ngIf="!isLoading && hasMoreItems">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="{{ TranslateKeys.TITLE_LOADING_MORE | translate }}">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

</ion-content>
