<app-header
  [pageTitle]="TranslateKeys.TITLE_FAMILY_DIALOGUE_SESSION_DETAIL"
  defaultBackHref="/{{PageRoutes.FAMILY_DIALOGUE_SESSION}}"
  backgroundColor="linear-gradient(to bottom, #9333ea, #4c1d95)"
>
</app-header>

<ion-content class="ion-padding font-comic-sans">
  <!-- Loading skeleton -->
  <div *ngIf="isLoading">
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 100%; height: 80px;" class="rounded-lg mb-3"></ion-skeleton-text>
  </div>

  <div *ngIf="!isLoading" class="mb-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h2 class="text-xl font-bold">{{ sessionDetail.title }}</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400">{{ formatDate(sessionDetail.date) }}</p>
      </div>
      <div class="text-center">
        <ion-badge
          [color]="sessionDetail.status === 'completed' ? 'success' : sessionDetail.status === 'in_progress' ? 'warning' : 'primary'"
          class="rounded-full px-3 py-1">
          {{ sessionDetail.status === 'completed' ? 'Đã hoàn thành' :
             sessionDetail.status === 'in_progress' ? 'Đang thực hiện' : 'Chưa thực hiện' }}
        </ion-badge>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6">
      <p class="text-gray-700 dark:text-gray-300">{{ sessionDetail.description }}</p>
    </div>

    <!-- Suggested Questions -->
    <h3 class="font-bold text-lg mb-4">{{ TranslateKeys.TITLE_SUGGESTED_QUESTIONS | translate }}</h3>
    <div class="space-y-6">
      <div *ngFor="let question of suggestedQuestions; let i = index"
           class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-4">
        <div class="mb-3">
          <h4 class="font-medium text-gray-800 dark:text-gray-200">{{ i + 1 }}. {{ question.text }}</h4>
        </div>

        <div *ngIf="sessionDetail.status === 'completed'">
          <p class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-gray-700 dark:text-gray-300">
            {{ question.answer }}
          </p>
        </div>

        <div *ngIf="sessionDetail.status !== 'completed'">
          <ion-item lines="none" class="bg-gray-100 dark:bg-gray-700 rounded-lg">
            <ion-textarea
              [(ngModel)]="question.answer"
              placeholder="Nhập câu trả lời của bạn..."
              rows="3"
              class="w-full">
            </ion-textarea>
          </ion-item>
        </div>
      </div>
    </div>

    <!-- Parent Questions -->
    <h3 class="font-bold text-lg mb-4 mt-6">{{ TranslateKeys.TITLE_PARENT_QUESTIONS | translate }}</h3>
    <div class="space-y-6">
      <div *ngFor="let question of parentQuestions; let i = index"
           class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-4">
        <div class="mb-3">
          <h4 class="font-medium text-gray-800 dark:text-gray-200">{{ i + 1 }}. {{ question.text }}</h4>
        </div>

        <div *ngIf="sessionDetail.status === 'completed'">
          <p class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-gray-700 dark:text-gray-300">
            {{ question.answer }}
          </p>
        </div>

        <div *ngIf="sessionDetail.status !== 'completed'">
          <ion-item lines="none" class="bg-gray-100 dark:bg-gray-700 rounded-lg">
            <ion-textarea
              [(ngModel)]="question.answer"
              placeholder="Nhập câu trả lời của bạn..."
              rows="3"
              class="w-full">
            </ion-textarea>
          </ion-item>
        </div>
      </div>
    </div>

  </div>
</ion-content>

<!-- Footer button for pending sessions -->
<ion-footer *ngIf="!isLoading && sessionDetail && sessionDetail.status !== 'completed'">
  <ion-toolbar>
    <div class="p-2">
      <ion-button expand="block"
                color="primary"
                class="rounded-full shadow-md uppercase font-bold"
                [disabled]="isSubmitting"
                (click)="submitAnswers()">
        <ion-spinner name="crescent" *ngIf="isSubmitting"></ion-spinner>
        <span *ngIf="!isSubmitting">{{ TranslateKeys.TITLE_ANSWER_QUESTIONS | translate }}</span>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>
