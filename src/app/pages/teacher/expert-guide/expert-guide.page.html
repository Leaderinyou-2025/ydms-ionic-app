<app-header
  [pageTitle]="TranslateKeys.TITLE_EXPERT_GUIDE_DETAIL"
  defaultBackHref="/{{PageRoutes.TEACHER_DASHBOARD}}"
  backgroundColor="linear-gradient(to bottom, #9333ea, #4c1d95)"
  [searchbar]="searchbarConfig"
  (inputSearch)="onSearchChange($event)">
</app-header>

<!-- Filter form -->
<ion-toolbar class="filter-form ion-no-padding">
  <div class="flex space-x-5 overflow-x-auto p-2">
    <!-- Area of expertise filter -->
    <ion-item lines="none" detail="false" class="select-type">
      <ion-select interface="action-sheet" (ionChange)="onAreaFilterChange($event)"
                  [value]="selectedAreaOfExpertise"
                  placeholder="{{ TranslateKeys.EXPERT_GUIDE_FILTER_AREA | translate }}">
        <ion-select-option [value]="'all'">
          {{ TranslateKeys.EXPERT_GUIDE_FILTER_ALL | translate }}
        </ion-select-option>
        <ion-select-option *ngFor="let area of areaOfExpertiseData" [value]="area.area">
          {{ area.title | translate }}
        </ion-select-option>
      </ion-select>
    </ion-item>
  </div>
</ion-toolbar>

<ion-content [fullscreen]="true" class="custom-page-bg-light">
  <!-- Refresh -->
  <ion-refresher slot="fixed" mode="md" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <!-- Loading skeleton -->
  <div *ngIf="isLoading" class="ion-padding">
    <ion-skeleton-text animated="true" class="w-full h-28 rounded-lg mb-3" *ngFor="let i of Array(10)"></ion-skeleton-text>
  </div>

  <!-- Guide list -->
  <div *ngIf="!isLoading && guideList.length > 0" class="ion-padding">
    <div class="space-y-3">
      <ion-card *ngFor="let guide of guideList"
                routerLink="/{{PageRoutes.EXPERT_GUIDE}}/{{guide.id}}"
                class="shadow-md border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-lg transition-shadow">
        <ion-card-content>
          <!-- Title -->
          <div class="font-medium text-xl mb-2">{{ guide.name }}</div>

          <!-- Description -->
          <div *ngIf="guide.desciption" class="text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2">
            {{ guide.desciption }}
          </div>

          <!-- Categories -->
          <div *ngIf="getCategoryNames(guide)" class="mb-3">
            <div class="flex flex-wrap gap-1">
              <ion-chip *ngFor="let category of guide.category_ids"
                        color="secondary"
                        class="text-xs">
                {{ category.name }}
              </ion-chip>
            </div>
          </div>

          <!-- Info row -->
          <div class="flex items-center justify-between pt-2 text-sm">
            <!-- Area of expertise -->
            <div class="flex items-center">
              <ion-icon name="school-outline" class="text-green-500 mr-1"></ion-icon>
              <span class="text-gray-600 dark:text-gray-400">{{ getAreaOfExpertiseTranslationKey(guide.area_of_expertise) | translate }}</span>
            </div>

            <!-- Scores and rank points -->
            <div class="flex items-center space-x-4">
              <div class="flex items-center">
                <ion-icon name="star-outline" class="text-yellow-500 mr-1"></ion-icon>
                <span class="text-yellow-600 font-medium">{{ guide.scores }}</span>
              </div>
              <div class="flex items-center">
                <ion-icon name="trophy-outline" class="text-orange-500 mr-1"></ion-icon>
                <span class="text-orange-600 font-medium">{{ guide.rank_point }}</span>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- No data message -->
  <div *ngIf="!isLoading && guideList.length === 0" class="text-center mt-8 ion-padding">
    <ion-icon name="document-outline" class="text-6xl text-gray-400 mb-4"></ion-icon>
    <p class="text-gray-500 dark:text-gray-400">{{ TranslateKeys.EXPERT_GUIDE_NO_DATA | translate }}</p>
  </div>

  <!-- Infinite scroll -->
  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMoreData($event)" [disabled]="!hasMoreData">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="{{ TranslateKeys.LOADING_MORE | translate }}">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>

<app-footer></app-footer>
