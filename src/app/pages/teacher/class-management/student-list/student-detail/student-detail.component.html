<app-header
  [pageTitle]="TranslateKeys.CLASS_MANAGEMENT_STUDENT_DETAIL"
  backgroundColor="linear-gradient(to bottom, #3b82f6, #1e40af)"
  [defaultBackHref]="'/class-management/student-list/' + classId">
</app-header>

<ion-content [fullscreen]="true" class="bg-white">
  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content
      [pullingText]="'LOADING.pull_to_refresh' | translate"
      [refreshingText]="'LOADING.refreshing' | translate">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Loading -->
  <div *ngIf="isLoading" class="flex justify-center items-center h-32">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <span class="ml-2 text-gray-600">{{ 'CLASS_MANAGEMENT.loading_students' | translate }}</span>
  </div>

  <!-- Student Detail Content -->
  <div class="p-4" *ngIf="!isLoading && student">
    <!-- Student Header Card -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-6">
      <div class="flex items-center space-x-4">
        <!-- Avatar -->
        <div class="flex-shrink-0">
          <ion-avatar class="w-20 h-20">
            <ion-img [src]="getAvatarUrl(student!)" [alt]="student!.name"></ion-img>
          </ion-avatar>
        </div>

        <!-- Basic Info -->
        <div class="flex-1">
          <h1 class="text-2xl font-bold text-gray-800">{{ student!.name }}</h1>
          <p class="text-lg text-gray-600" *ngIf="student!.nickname">{{ student!.nickname }}</p>
          <p class="text-sm text-blue-600 font-medium" *ngIf="student!.edu_id">
            {{ TranslateKeys.CLASS_MANAGEMENT_STUDENT_CODE | translate }}: {{ student!.edu_id }}
          </p>
        </div>
      </div>
    </div>

    <!-- Student Information Cards -->
    <div class="space-y-4">
      <!-- Contact Information -->
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4">
        <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
          <ion-icon name="person-outline" class="mr-2 text-blue-500"></ion-icon>
          {{ TranslateKeys.CLASS_MANAGEMENT_STUDENT_INFO | translate }}
        </h2>
        
        <div class="space-y-3">
          <!-- Email -->
          <div class="flex items-center" *ngIf="student!.email">
            <ion-icon name="mail-outline" class="mr-3 text-green-500 w-5 h-5"></ion-icon>
            <div class="flex-1">
              <p class="text-sm text-gray-500">{{ TranslateKeys.CLASS_MANAGEMENT_EMAIL | translate }}</p>
              <p class="text-gray-800">{{ student!.email }}</p>
            </div>
          </div>

          <!-- Phone -->
          <div class="flex items-center" *ngIf="student!.phone">
            <ion-icon name="call-outline" class="mr-3 text-orange-500 w-5 h-5"></ion-icon>
            <div class="flex-1">
              <p class="text-sm text-gray-500">{{ TranslateKeys.CLASS_MANAGEMENT_PHONE | translate }}</p>
              <p class="text-gray-800">{{ student!.phone }}</p>
            </div>
          </div>

          <!-- Date of Birth -->
          <div class="flex items-center" *ngIf="student!.dob">
            <ion-icon name="calendar-outline" class="mr-3 text-purple-500 w-5 h-5"></ion-icon>
            <div class="flex-1">
              <p class="text-sm text-gray-500">{{ TranslateKeys.CLASS_MANAGEMENT_DATE_OF_BIRTH | translate }}</p>
              <p class="text-gray-800">{{ formatDate(student!.dob) }}</p>
            </div>
          </div>

          <!-- Gender -->
          <div class="flex items-center" *ngIf="student!.gender">
            <ion-icon name="person-circle-outline" class="mr-3 text-pink-500 w-5 h-5"></ion-icon>
            <div class="flex-1">
              <p class="text-sm text-gray-500">{{ TranslateKeys.CLASS_MANAGEMENT_GENDER | translate }}</p>
              <p class="text-gray-800">{{ getGenderKey(student!.gender) | translate }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Academic Information -->
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4" *ngIf="student!['total_score'] || student!['class_rank']">
        <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
          <ion-icon name="school-outline" class="mr-2 text-indigo-500"></ion-icon>
          Thông tin học tập
        </h2>

        <div class="space-y-3">
          <!-- Total Score -->
          <div class="flex items-center" *ngIf="student!['total_score']">
            <ion-icon name="trophy-outline" class="mr-3 text-yellow-500 w-5 h-5"></ion-icon>
            <div class="flex-1">
              <p class="text-sm text-gray-500">{{ TranslateKeys.CLASS_MANAGEMENT_TOTAL_SCORE | translate }}</p>
              <p class="text-gray-800 font-semibold">{{ student!['total_score'] }} điểm</p>
            </div>
          </div>

          <!-- Class Rank -->
          <div class="flex items-center" *ngIf="student!['class_rank']">
            <ion-icon name="medal-outline" class="mr-3 text-red-500 w-5 h-5"></ion-icon>
            <div class="flex-1">
              <p class="text-sm text-gray-500">{{ TranslateKeys.CLASS_MANAGEMENT_CLASS_RANK | translate }}</p>
              <p class="text-gray-800 font-semibold">Hạng {{ student!['class_rank'] }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No student found -->
  <div *ngIf="!isLoading && !student" class="flex flex-col items-center justify-center h-64">
    <ion-icon name="person-outline" class="text-6xl text-gray-400 mb-4"></ion-icon>
    <p class="text-gray-500 text-lg">Không tìm thấy thông tin học sinh</p>
  </div>
</ion-content>
