<app-header
  [pageTitle]="TranslateKeys.NOTIFICATIONS_TITLE"
  backgroundColor="linear-gradient(to bottom, #3b82f6, #1e40af)"
  [segment]="segment"
  [searchbar]="searchbar"
  (changeSegment)="onSegmentChange($event)"
  (inputSearch)="onSearchInput($event)">
</app-header>

<!-- Filter form -->
<ion-toolbar class="filter-form ion-no-padding">
  <div class="flex space-x-5 overflow-x-auto p-2">
    <!-- From date -->
    <app-select-datetime [required]="true" (selectedDatetime)="onSelectStartDate($event)"
                         [default]="false"
                         placeholder="{{TranslateKeys.NOTIFICATIONS_SEARCH_FROM_DATE | translate}}">
    </app-select-datetime>

    <!-- To date -->
    <app-select-datetime [required]="true" (selectedDatetime)="onSelectEndDate($event)"
                         [default]="false"
                         placeholder="{{TranslateKeys.NOTIFICATIONS_SEARCH_TO_DATE | translate}}">
    </app-select-datetime>

    <!-- Type filter -->
    <ion-item lines="none" class="select-type min-w-max">
      <ion-select interface="action-sheet" (ionChange)="onFilterChange($event)"
                  placeholder="{{ TranslateKeys.NOTIFICATIONS_SEARCH_TYPE | translate }}">
        <ion-select-option *ngFor="let type of notificationTypes" [value]="type.value">
          {{ type.label }}
        </ion-select-option>
      </ion-select>
    </ion-item>
  </div>
</ion-toolbar>

<ion-content [fullscreen]="true" class="custom-page-bg-light">
  <!-- Pull to refresh -->
  <ion-refresher mode="md" slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-list *ngIf="notifications?.length" class="bg-transparent pt-4 ion-padding-start ion-padding-end">
    <ion-item *ngFor="let notification of notifications"
              routerLink="/{{PageRoutes.NOTIFICATIONS}}/{{notification.id}}"
              class="mb-3 rounded-xl shadow notification-item"
              [class.bg-white]="!notification.is_viewed"
              [class.dark:bg-gray-700]="!notification.is_viewed"
              [class.bg-gray-100]="notification.is_viewed"
              [class.dark:bg-gray-800]="notification.is_viewed"
              lines="none" detail="false">

      <div class="flex w-full items-start">
        <!-- Mail icon instead of avatar -->
        <div class="flex items-center justify-center mr-3 w-10 h-10">
          <ion-icon
            [name]="notification.is_viewed ? 'mail-open-outline' : 'mail-unread-outline'"
            [color]="notification.is_viewed ? 'medium' : 'danger'"
            class="text-2xl">
          </ion-icon>
        </div>

        <div class="flex-1">
          <!-- Title -->
          <div class="font-bold text-sm text-blue-600 dark:text-blue-400 mb-1">
            {{ notification.name }}
          </div>

          <!-- Message body -->
          <div [class.font-medium]="!notification.is_viewed"
               [class.text-gray-600]="notification.is_viewed"
               [class.dark:text-gray-300]="notification.is_viewed"
               class="mb-1">
            {{ notification.description }}
          </div>

          <!-- Footer: Timestamp and Type -->
          <div class="flex justify-between items-center">
            <div class="text-xs text-gray-500 dark:text-gray-400">
              {{ notification['create_time']}} {{ notification.create_date | date: DateFormat.DATE_ONLY }}
            </div>

            <div class="notification-type px-2 py-1 text-xs text-white border rounded-full shadow-md"
                 [class]="getTypeBackground(notification)">
              {{ getNotificationTypeLabel(notification) }}
            </div>
          </div>
        </div>
      </div>
    </ion-item>
  </ion-list>

  <!-- Empty state for search results -->
  <div *ngIf="!notifications?.length && isLoading === false && !isLoadMore && !isRefresh"
       class="p-8 text-center text-gray-500 dark:text-gray-400">
    <ion-icon name="search-outline" class="text-6xl mb-4"></ion-icon>
    <p>{{ TranslateKeys.NOTIFICATIONS_NO_RESULTS | translate }}</p>
  </div>

  <!-- Infinite scroll -->
  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMoreNotifications($event)">
    <ion-infinite-scroll-content loadingSpinner="crescent"></ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>

<app-footer></app-footer>
